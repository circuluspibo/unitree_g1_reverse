(function(){"use strict";var j=(()=>{var c=self.location.href;return function(s={}){var t=s,i,u;t.ready=new Promise((e,n)=>{i=e,u=n});var h=Object.assign({},t),f=!0,a="";function o(e){return t.locateFile?t.locateFile(e,a):a+e}var m;a=self.location.href,c&&(a=c),a.startsWith("blob:")?a="":a=a.substr(0,a.replace(/[?#].*/,"").lastIndexOf("/")+1),m=e=>{var n=new XMLHttpRequest;return n.open("GET",e,!1),n.responseType="arraybuffer",n.send(null),new Uint8Array(n.response)},t.print||console.log.bind(console);var _=t.printErr||console.error.bind(console);Object.assign(t,h),h=null,t.arguments&&t.arguments,t.thisProgram&&t.thisProgram,t.quit&&t.quit;var p;t.wasmBinary&&(p=t.wasmBinary);var E,x=!1,O,B,M,S,D,T,W;function K(){var e=E.buffer;t.HEAP8=O=new Int8Array(e),t.HEAP16=M=new Int16Array(e),t.HEAPU8=B=new Uint8Array(e),t.HEAPU16=new Uint16Array(e),t.HEAP32=S=new Int32Array(e),t.HEAPU32=D=new Uint32Array(e),t.HEAPF32=T=new Float32Array(e),t.HEAPF64=W=new Float64Array(e)}var F=[],V=[],z=[];function X(){if(t.preRun)for(typeof t.preRun=="function"&&(t.preRun=[t.preRun]);t.preRun.length;)Y(t.preRun.shift());U(F)}function J(){U(V)}function Q(){if(t.postRun)for(typeof t.postRun=="function"&&(t.postRun=[t.postRun]);t.postRun.length;)tt(t.postRun.shift());U(z)}function Y(e){F.unshift(e)}function Z(e){V.unshift(e)}function tt(e){z.unshift(e)}var y=0,R=null;function et(e){y++,t.monitorRunDependencies?.(y)}function nt(e){if(y--,t.monitorRunDependencies?.(y),y==0&&R){var n=R;R=null,n()}}function P(e){t.onAbort?.(e),e="Aborted("+e+")",_(e),x=!0,e+=". Build with -sASSERTIONS for more info.";var n=new WebAssembly.RuntimeError(e);throw u(n),n}var it="data:application/octet-stream;base64,",N=e=>e.startsWith(it),A;t.locateFile?(A="libvoxel.wasm",N(A)||(A=o(A))):A=new URL("/assets/libvoxel-Bqa6xB-f.wasm",self.location.href).href;function q(e){if(e==A&&p)return new Uint8Array(p);if(m)return m(e);throw"both async and sync fetching of the wasm failed"}function rt(e){return!p&&f&&typeof fetch=="function"?fetch(e,{credentials:"same-origin"}).then(n=>{if(!n.ok)throw`failed to load wasm binary file at '${e}'`;return n.arrayBuffer()}).catch(()=>q(e)):Promise.resolve().then(()=>q(e))}function $(e,n,l){return rt(e).then(r=>WebAssembly.instantiate(r,n)).then(l,r=>{_(`failed to asynchronously prepare wasm: ${r}`),P(r)})}function at(e,n,l,r){return!e&&typeof WebAssembly.instantiateStreaming=="function"&&!N(n)&&typeof fetch=="function"?fetch(n,{credentials:"same-origin"}).then(b=>{var H=WebAssembly.instantiateStreaming(b,l);return H.then(r,function(C){return _(`wasm streaming compile failed: ${C}`),_("falling back to ArrayBuffer instantiation"),$(n,l,r)})}):$(n,l,r)}function ut(){var e={a:ct};function n(r,b){return d=r.exports,E=d.b,K(),Z(d.c),nt(),d}et();function l(r){n(r.instance)}if(t.instantiateWasm)try{return t.instantiateWasm(e,n)}catch(r){_(`Module.instantiateWasm callback failed with error: ${r}`),u(r)}return at(p,A,e,l).catch(u),{}}var U=e=>{for(;e.length>0;)e.shift()(t)};function ot(e,n="i8"){switch(n.endsWith("*")&&(n="*"),n){case"i1":return O[e];case"i8":return O[e];case"i16":return M[e>>1];case"i32":return S[e>>2];case"i64":P("to do getValue(i64) use WASM_BIGINT");case"float":return T[e>>2];case"double":return W[e>>3];case"*":return D[e>>2];default:P(`invalid type for getValue: ${n}`)}}t.noExitRuntime;var st=e=>{P("OOM")},lt=e=>{B.length,st()},ct={a:lt},d=ut();t._reset=()=>(t._reset=d.d)(),t._generate=(e,n,l,r,b,H,C,ft,dt,ht,mt,_t,pt,yt,At)=>(t._generate=d.e)(e,n,l,r,b,H,C,ft,dt,ht,mt,_t,pt,yt,At),t._malloc=e=>(t._malloc=d.f)(e),t._free=e=>(t._free=d.g)(e),t.getValue=ot;var I;R=function e(){I||L(),I||(R=e)};function L(){if(y>0||(X(),y>0))return;function e(){I||(I=!0,t.calledRun=!0,!x&&(J(),i(t),t.onRuntimeInitialized&&t.onRuntimeInitialized(),Q()))}t.setStatus?(t.setStatus("Running..."),setTimeout(function(){setTimeout(function(){t.setStatus("")},1),e()},1)):e()}if(t.preInit)for(typeof t.preInit=="function"&&(t.preInit=[t.preInit]);t.preInit.length>0;)t.preInit.pop()();return L(),s.ready}})();async function G(){return await j()}const w=1e6;class k{_module;_input;_outputDict;_outputIndices;_output;_directOutput;_outputCount;_addedCount;_lastCount;constructor(s){this._module=s,this._input=this._module._malloc(2e5),this._directOutput=this._module._malloc(3e5),this._outputCount=this._module._malloc(4),this._addedCount=this._module._malloc(4),this._outputDict=this._module._malloc(67108864),this._outputIndices=this._module._malloc(w*4),this._output=this._module._malloc(w*12),this._lastCount=0}clear(){this._module.HEAPU8.fill(0,this._outputDict,67108864),this._module.HEAPU8.fill(0,this._outputIndices,w*4),this._module._reset()}generate(s,t,i,u,h,f,a){this._module.HEAPU8.set(a,this._input);const o=a.length/6;this._module._generate(s,t,i,u,h,f,o,this._input,w,this._outputDict,this._outputIndices,this._directOutput,this._output,this._addedCount,this._outputCount);const m=this._module.getValue(this._outputCount,"i32"),_=this._module.getValue(this._addedCount,"i32"),p=new Float32Array(this._module.HEAPU8.subarray(this._output,this._output+m*12).slice().buffer),E=new Float32Array(this._module.HEAPU8.subarray(this._directOutput,this._directOutput+o*12).slice().buffer);return this._lastCount=m,{directCount:o,directOutput:E,outputCount:m,output:p,addedCount:_}}}const v=self;let g=null;G().then(c=>{g=new k(c)}),v.addEventListener("message",c=>{if(g)if(c.data==="clear")g.clear();else{const s=c.data,t=s.type;if(t=="newMap"){const i=s.data,u=g.generate(i.xmin,i.xmax,i.ymin,i.ymax,i.zmin,i.zmax,new Uint8Array(i.data));v.postMessage({type:t,data:u})}else if(["location","navigation-path"].includes(t)){const i=s.data,u=new Uint16Array(i.data),h=u.length,f=new Float32Array(h);for(let a=0;a<h;a++){const o=a*3;f[o]=i.xmin+u[o]*.001,f[o+1]=i.ymin+u[o+1]*.001,f[o+2]=i.zmin+u[o+2]*.001}v.postMessage({type:t,data:{points:f}})}else t=="check"&&v.postMessage({type:t})}},!1),v.addEventListener("error",()=>{console.log("error")})})();
